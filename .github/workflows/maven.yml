# 工作流名称
name: 编译后端 yudao-server Jar 包

# 触发方式：仅手动触发
on:
  workflow_dispatch:

# 定义任务
jobs:
  build-backend:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出仓库代码
      - name: 检出代码
        uses: actions/checkout@v3

      # 步骤2：配置 JDK 8
      - name: 安装并配置 JDK 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'
          cache: maven

      # 步骤3：配置阿里云 Maven 镜像
      - name: 配置阿里云 Maven 镜像
        run: |
          mkdir -p ~/.m2
          echo "<settings>
            <mirrors>
              <mirror>
                <id>aliyun-central</id>
                <url>https://maven.aliyun.com/repository/public</url>
                <mirrorOf>central</mirrorOf>
              </mirror>
              <mirror>
                <id>aliyun-spring</id>
                <url>https://maven.aliyun.com/repository/spring</url>
                <mirrorOf>spring</mirrorOf>
              </mirror>
            </mirrors>
          </settings>" > ~/.m2/settings.xml

      # 步骤4：编译 yudao-server 模块
      - name: 编译后端 Jar 包
        run: mvn clean package -DskipTests -pl yudao-server -am
        timeout-minutes: 10

      # 步骤5：上传编译好的 Jar 包（升级为 v4 版本，解决废弃报错）
      - name: 上传 Jar 包产物
        uses: actions/upload-artifact@v4  # 这里从 v3 升级为 v4
        with:
          name: yudao-server-jar
          path: yudao-server/target/yudao-server.jar
          retention-days: 90
